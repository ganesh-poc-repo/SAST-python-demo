name: SAST-python-demo
on:
  branch: master
jobs:
  build-and-test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up environment
        uses: actions/setup-python@v2
        with:
          python-version: '3.x'

      - name: Install dependencies
        run: |
          pip install --upgrade pip
          pip install -r requirements.txt

      - name: Run build and tests
        run: |
          python setup.py sdist bdist_wheel
          python -m twine upload dist/*
          pytest -v tests/

      - name: List library dependencies
        run: |
          pip freeze > requirements.txt

      - name: Add SonarQube details
        uses: sonarqube/sonarcloud-analysis@v1.0.4
        with:
          sonarorg: your-sonarqube-url.com
          sonarproject-key: your-project-key
          token: ${{ secrets.SONAR_TOKEN }}

      - name: Add Artifactory details
        uses: artifactory/gradle-artifactor@v1.0.4
        with:
          username: your-username
          password: ${{ secrets.ARTIFACTORY_PASSWORD }}
          url: 'your-artifactory-url'

      - name: SAST & SCA scan
        uses: sonarqube/sonarcloud-analysis@v1.0.4
        with:
          sonarorg: your-sonarqube-url.com
          sonarproject-key: your-project-key
          token: ${{ secrets.SONAR_TOKEN }}
          analysisMode: full